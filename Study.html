
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>exp</title>
  <script src="jsPsych-6.1.0/jspsych.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-text.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="js/jspsych-html-slider-response_required.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-external-html.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-mouse-response.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/lodash.min.js"></script>
  <script src="js/firebase.js"></script>
  <link href="jsPsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
    body {
      cursor: default;
    }
    .jspsych-content-wrapper {
      width: 900px;
      height: 1200px;
    }
    .paringsImgsLeft,
    .paringsImgsRight {
      height: 320px;
      margin: 0px;
    }
    .imgInstr {
      height: 150px; 
    }
    .paringsImgsLeft {
      margin-right: 10px;
    }
    .displayInstr {
      height: 130px;
    }
    .rcimg-12 {
      cursor: pointer;
    }
    .rcimg-12 {
      margin: 10px;
    }
    .rcimg-12:hover {
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }   
  </style>
</head>
<body></body>
<script>

  /* Parameters for the Evaluative Conditioning part */
  var delayIti = 1000;  // inter-trial-interval for trials
  var delayTrial = 2500; // duration of each trial
  var numOfUS = 8; // number of US to be paired with each CS

  /* Parameters for the Reverse Correlation task */
  var numOfPairs = 150 * 6; 

  /* Functions */
    // Return image link
    var imgLink = function (imgNum, oriInv) {

        if (oriInv == "inv") {
            return 'https://marinerougier.github.io/Plac_EC_instr_2/CIs_Inv/faceInv' + imgNum + '.png?raw=1'
        } else {
            return 'https://marinerougier.github.io/Plac_EC_instr_2/CIs_Ori/faceOri' + imgNum + '.png?raw=1'
        };
    };

  /* Initial variables */
  var timeline = [];
  var preloadimages = [];
  var stims = [];

  var jspsych_id = jsPsych.data.getURLVariable("id");
  jspsych_id = jspsych_id == null ? jsPsych.randomization.randomID(15) : jspsych_id; // assign random id if not provided in URL
  var prolificID = jsPsych.data.getURLVariable("PROLIFIC_PID");
  if(prolificID == null) {prolificID = "999";}

  // Variable coding for the blue/yellow pairing with pleasant/unpleasant pictures
  var pairing_cond = jsPsych.data.getURLVariable("pairing_cond");
  if(pairing_cond == null) {pairing_cond = jsPsych.randomization.sampleWithoutReplacement(["placebo_blue_pos_G1B", "placebo_yellow_pos_G1B", "placebo_blue_pos_G1Y", "placebo_yellow_pos_G1Y","instruction_blue_pos_G1B", "instruction_yellow_pos_G1B", "instruction_blue_pos_G1Y", "instruction_yellow_pos_G1Y"], 1)[0];}

  /* Material */
  // US stimuli 
  var US_pos = [
  'us_posneg/uspos/1463.jpg',
  'us_posneg/uspos/1590.jpg',
  'us_posneg/uspos/5260.jpg',
  'us_posneg/uspos/5270.jpg',
  'us_posneg/uspos/7260.jpg',
  'us_posneg/uspos/7270.jpg',
  'us_posneg/uspos/7330.jpg',
  'us_posneg/uspos/8170.jpg',
  ];
  
  var US_neg = [
  'us_posneg/usneg/1275.jpg',
  'us_posneg/usneg/7380.jpg',
  'us_posneg/usneg/9181.jpg',
  'us_posneg/usneg/9280.jpg',
  'us_posneg/usneg/9290.jpg',
  'us_posneg/usneg/9373.jpg',
  'us_posneg/usneg/9405.jpg',
  'us_posneg/usneg/9830.jpg',
  ];

  // Preload all the faces with their background color (for the instruction)
  var faces = [
        "stimuli/Face19_B.png",
        "stimuli/Face28_B.png",
        "stimuli/Face55_B.png",
        "stimuli/Face95_B.png",
        "stimuli/Face104_B.png",
        "stimuli/Face115_B.png",
        "stimuli/Face119_B.png",
        "stimuli/Face142_B.png",
        "stimuli/Face10_J.png",
        "stimuli/Face16_J.png",
        "stimuli/Face17_J.png",
        "stimuli/Face45_J.png",
        "stimuli/Face85_J.png",
        "stimuli/Face103_J.png",
        "stimuli/Face116_J.png",
        "stimuli/Face132_J.png",
        "stimuli/Face19_J.png",
        "stimuli/Face28_J.png",
        "stimuli/Face55_J.png",
        "stimuli/Face95_J.png",
        "stimuli/Face104_J.png",
        "stimuli/Face115_J.png",
        "stimuli/Face119_J.png",
        "stimuli/Face142_J.png",
        "stimuli/Face10_B.png",
        "stimuli/Face16_B.png",
        "stimuli/Face17_B.png",
        "stimuli/Face45_B.png",
        "stimuli/Face85_B.png",
        "stimuli/Face103_B.png",
        "stimuli/Face116_B.png",
  ];

// Preload the pleasant / unpleasant images (for the instructions)
  var posnegimages = [
        "us_posneg/instructions/1463.jpg",
        "us_posneg/instructions/1590.jpg",
        "us_posneg/instructions/5260.jpg",
        "us_posneg/instructions/5270.jpg",
        "us_posneg/instructions/7260.jpg",
        "us_posneg/instructions/7270.jpg",
        "us_posneg/instructions/7330.jpg",
        "us_posneg/instructions/8170.jpg",
        "us_posneg/instructions/1275.jpg",
        "us_posneg/instructions/7380.jpg",
        "us_posneg/instructions/9181.jpg",
        "us_posneg/instructions/9280.jpg",
        "us_posneg/instructions/9290.jpg",
        "us_posneg/instructions/9373.jpg",
        "us_posneg/instructions/9405.jpg",
        "us_posneg/instructions/9830.jpg"
  ];

// Preload all the face without their background color and as a function of their group (for the EC task)
  var group1 = [
  "stimuli_CS/Face19.png", 
  "stimuli_CS/Face28.png",
  "stimuli_CS/Face55.png",
  "stimuli_CS/Face95.png",
  "stimuli_CS/Face104.png",
  "stimuli_CS/Face115.png",
  "stimuli_CS/Face119.png",
  "stimuli_CS/Face142.png"
  ];

  var group2 = [
  "stimuli_CS/Face10.png", 
  "stimuli_CS/Face16.png",
  "stimuli_CS/Face17.png",
  "stimuli_CS/Face45.png",
  "stimuli_CS/Face85.png",
  "stimuli_CS/Face103.png",
  "stimuli_CS/Face116.png",
  "stimuli_CS/Face132.png"
  ];

  // preload
  preloadimages.push(US_pos, US_neg, faces, posnegimages, group1, group2);

  // randomize order
  US_pos = _.shuffle(US_pos);
  US_neg = _.shuffle(US_neg);
  group1 = _.shuffle(group1);
  group2 = _.shuffle(group2);

  // Creating the two lists of stimuli (having both gp1 and gp2 faces)
  var Selection_pos_gp1 = ([group1[0],group1[1],group1[2], group1[3]]);
  var Selection_pos_gp2 = ([group2[0],group2[1],group2[2], group2[3]]);
  var Selection_neg_gp1 = ([group1[4],group1[5],group1[6], group1[7]]);
  var Selection_neg_gp2 = ([group2[4],group2[5],group2[6], group2[7]]);

  var pos_list = _.flattenDeep([Selection_pos_gp1, Selection_pos_gp2]);
  var neg_list = _.flattenDeep([Selection_neg_gp1, Selection_neg_gp2]);

  pos_list = _.shuffle(pos_list);
  neg_list = _.shuffle(neg_list);

  var CS = _.flattenDeep([pos_list, neg_list]);
  var US = _.flattenDeep([US_pos, US_neg]);

  /* Functions */
  // duplicate elements of an array n times
  // see https://stackoverflow.com/questions/56330349/how-to-duplicate-elements-in-a-js-array-without-creating-dependent-elements?
  /*
  function duplicateElements(elementsArray, times) {
    var newArray = [];
    for (let index = 0; index < elementsArray.length; index++) {
      var currentElement = elementsArray[index];
      var currentType = typeof currentElement
      for (let index = 0; index < times; index++) {
        if (currentType !== "object" && currentType) {
          newArray.push(currentElement)
        } else if (currentType === "object" && currentType) {
          newArray.push({ ...currentElement })
        }
      }
    }
    return newArray;
  }
*/
  /* RANDOMIZATION ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  /* EC PROCEDURE */

  // generate US-CS parings
  CS.map(function (e) { stims.push({ CS: e }) });
  stims.map(function (e, i) { e.US = US[i] });


  // fixed US-CS horizontal position
  var CSposition = jsPsych.randomization.sampleWithoutReplacement(["LEFT", "RIGHT"], 1)[0];

  if (CSposition == "LEFT") {
      var USposition = "RIGHT";
    } else {
      var USposition = "LEFT";
  };

/* RC PROCEDURE */
 var genColor = function (colorID, colorName) { return "<span style='color:" + colorID + "'><b>" + colorName + "</b></span>" };

 var colorOrder = colorOrder == null ? _.sample(["blueFirst", "yellowFirst"]) : colorOrder;

    if (colorOrder == "blueFirst") {
        var color1 = genColor("#2a57ea", "blue");
        var color2 = genColor("#b5a21b", "yellow");
        var color1name = "bleu";
        var color2name = "jaune";
    } else {
        var color1 = genColor("#b5a21b", "yellow");
        var color2 = genColor("#2a57ea", "blue");
        var color1name = "jaune";
        var color2name = "bleu";
    };

  /* EXPERIMENT ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  /* Fullscreen mode & Consent */
    var activeFullscreen = {
      message: "",
      button_label: "To start the study, please switch to fullscreen",
      type: 'fullscreen',
      fullscreen_mode: true,
      delay_after: 200,
    };

    // Consent
    var check_consent = function(elem) {
      if (document.getElementById('info').checked 
        & document.getElementById('volunt').checked 
        & document.getElementById('anony').checked 
        & document.getElementById('end').checked 
        & document.getElementById('consqc').checked 
        & document.getElementById('summ').checked 
        & document.getElementById('participate').checked ) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check all the boxes.");
        return false;
      }
      return false;
    };


    var consent = {
      type:'external-html',
      url: "https://marinerougier.github.io/Plac_EC_instr_2/external_page_consent.html",
      cont_btn: "start",
      on_load: function() {
          $('.jspsych-content-wrapper').css({ "height": "1500px" });
    },
      check_fn: check_consent
    };

  /* General INSTRUCTIONS */
  var Instr_gene1 = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>About this study</h1>";
      html += "<p class = 'justify'>In this study, you will complete a few tasks and answer a few questions. ";
      html += "The whole study should last around <b>25 minutes</b>. Note that it is extremely important that ";
      html += "you remain <b>fully concentrated</b> during the entire study.</b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };


  /* EC INSTRUCTIONS */
 var Instr_EC_1_PlacEC = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>In the following task, ";
      html += "you will be presented with a series of pictures. ";
      html += "More specifically, you will be presented with pictures of blurred faces and with pleasant and unpleasant pictures. ";
      html += "Pictures of faces will be presented on the "+CSposition+" of the screen whereas pleasant and unpleasant pictures will be on the "+USposition+" of the screen.<br><br>"
      html += "<p class='justify'>Your task will be to <b><u>look carefully at ";
      html += "all the pictures</u> (i.e., both pictures on the left and on the right). </b>The task will be automatically paced, <b>please remain focused.<br><br></b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to start TASK 1</p>";
      return html;
    },
  };

 var Instr_EC_1_Instr = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>In the following task, ";
      html += "you will be presented with pictures of blurred faces that will be displayed at the center of the screen. ";
      html += "<p class='justify'>Your task will be to <b><u>look carefully at ";
      html += "the pictures</u>. </b>The task will be automatically paced, <b>please remain focused.<br><br></b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to start TASK 1</p>";
      return html;
    },
  };

 var Instr_EC_2_G1Y = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before going further, you should know that <b>the faces that were displayed in the previous task are ";
      html += "in fact divided into two distinct groups</b> of faces: Faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group and faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group.<br><br> "
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face19_B.png'>";
      html += "<img src = 'stimuli/Face28_B.png'>";
      html += "<img src = 'stimuli/Face55_B.png'>";
      html += "<img src = 'stimuli/Face95_B.png'><br>";
      html += "<img src = 'stimuli/Face104_B.png'>";
      html += "<img src = 'stimuli/Face115_B.png'>";
      html += "<img src = 'stimuli/Face119_B.png'>";
      html += "<img src = 'stimuli/Face142_B.png'><br><br>";
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face10_J.png'>";
      html += "<img src = 'stimuli/Face16_J.png'>";
      html += "<img src = 'stimuli/Face17_J.png'>";
      html += "<img src = 'stimuli/Face45_J.png'><br>";
      html += "<img src = 'stimuli/Face85_J.png'>";
      html += "<img src = 'stimuli/Face103_J.png'>";
      html += "<img src = 'stimuli/Face116_J.png'>";
      html += "<img src = 'stimuli/Face132_J.png'><br><br>";
      html += "<p class='instructions'><b>Please, take a few moments to look at the faces. </b></b>More specific instructions will follow.<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

 var Instr_EC_2_G1B = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before going further, you should know that <b>the faces that were displayed in the previous task are ";
      html += "in fact divided into two distinct groups</b> of faces: Faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group and faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group.<br><br> "
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face10_B.png'>";
      html += "<img src = 'stimuli/Face16_B.png'>";
      html += "<img src = 'stimuli/Face17_B.png'>";
      html += "<img src = 'stimuli/Face45_B.png'><br>";
      html += "<img src = 'stimuli/Face85_B.png'>";
      html += "<img src = 'stimuli/Face103_B.png'>";
      html += "<img src = 'stimuli/Face116_B.png'>";
      html += "<img src = 'stimuli/Face132_B.png'><br><br>";
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face19_J.png'>";
      html += "<img src = 'stimuli/Face28_J.png'>";
      html += "<img src = 'stimuli/Face55_J.png'>";
      html += "<img src = 'stimuli/Face95_J.png'><br>";
      html += "<img src = 'stimuli/Face104_J.png'>";
      html += "<img src = 'stimuli/Face115_J.png'>";
      html += "<img src = 'stimuli/Face119_J.png'>";
      html += "<img src = 'stimuli/Face142_J.png'><br><br>";
      html += "<p class='instructions'><b>Please, take a few moments to look at the faces. </b></b>More specific instructions will follow.<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };


 var Instr_EC_3_posBlue_placebo = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the previous task: ";
      html += "<li><strong>The faces that were presented together with <b><u>pleasant images</b></u> were always those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that were presented together with <u><b>unpleasant images</b></u> were always those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

 var Instr_EC_3_posYellow_placebo = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the previous task: ";
      html += "<li><strong>The faces that were presented together with <b><u>unpleasant images</b></u> were always those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that were presented together with <u><b>pleasant images</b></u> were always those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

var Instr_EC_instruction_intermediary = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>In the previous task, faces of the blue and yellow groups were presented alone on the screen. However, <b>in the upcoming task, faces will be presented together with pleasant or unpleasant pictures (see below).</b><br><br>";
      html += "<center><p class='instructions'>Here are the <b>pleasant</b> pictures:</b></p>";
      html += "<img src = 'us_posneg/instructions/1463.jpg'>";
      html += "<img src = 'us_posneg/instructions/1590.jpg'>";
      html += "<img src = 'us_posneg/instructions/5260.jpg'>";
      html += "<img src = 'us_posneg/instructions/5270.jpg'><br>";
      html += "<img src = 'us_posneg/instructions/7260.jpg'>";
      html += "<img src = 'us_posneg/instructions/7270.jpg'>";
      html += "<img src = 'us_posneg/instructions/7330.jpg'>";
      html += "<img src = 'us_posneg/instructions/8170.jpg'><br><br>";
      html += "<center><p class='instructions'>Here are the <b>unpleasant</b> pictures:</b></p>";
      html += "<img src = 'us_posneg/instructions/1275.jpg'>";
      html += "<img src = 'us_posneg/instructions/7380.jpg'>";
      html += "<img src = 'us_posneg/instructions/9181.jpg'>";
      html += "<img src = 'us_posneg/instructions/9280.jpg'><br>";
      html += "<img src = 'us_posneg/instructions/9290.jpg'>";
      html += "<img src = 'us_posneg/instructions/9373.jpg'>";
      html += "<img src = 'us_posneg/instructions/9405.jpg'>";
      html += "<img src = 'us_posneg/instructions/9830.jpg'><br><br>";      
      html += "<p class='instructions'><b>Please, take a few moments to look at the pictures. </b></b>More specific instructions will follow.<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

var Instr_EC_3_posBlue_instruction = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the upcoming task: ";
      html += "<li><strong>The faces that will be presented together with <b><u>pleasant images</b></u> will always be those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that will be presented together with <u><b>unpleasant images</b></u> will always be those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'></b>Before experiencing this upcoming task <b>you will go through another intermediary task.</b> You will go through this task at the very end of the experiment. Therefore, read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

var Instr_EC_3_posYellow_instruction = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the upcoming task: ";
      html += "<li><strong>The faces that will be presented together with <b><u>unpleasant images</b></u> will always be those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that will be presented together with <u><b>pleasant images</b></u> will always be those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'></b>Before experiencing this upcoming task <b>you will go through another intermediary task.</b> You will go through this task at the very end of the experiment. Therefore, read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

  // EC ---------------------------------------------------------------------------------------------------------------
  // Bogus EC
  var evacond = {
    timeline_variables: stims,
    randomize_order: true,
    choices: jsPsych.NO_KEYS,
    trial_duration: delayTrial,
    post_trial_gap: delayIti,
    repetitions: 2, // total: 32 trials
    on_load: function () {
      $('.jspsych-content').css({ "max-width": "100%" });
    },
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function () {
        if (CSposition == "LEFT") {
          var leftImg = jsPsych.timelineVariable('CS', true);
          var rightImg = jsPsych.timelineVariable('US', true);
        } else {
          var leftImg = jsPsych.timelineVariable('US', true);
          var rightImg = jsPsych.timelineVariable('CS', true);
        };
        html = '';
        html += "<img class='paringsImgsLeft' src='" + leftImg + "'>";
        html += "<img class='paringsImgsRight' src='" + rightImg + "'>";
        return html;
      },
      on_finish: function (data) {
        $('.jspsych-content').css({ "max-width": "90%" });
        data.task = "evacond";
        data.CS = jsPsych.timelineVariable('CS', true);
        data.US = jsPsych.timelineVariable('US', true);
        data.CSposition = jsPsych.timelineVariable('CSposition', true);
      },
    }]
  };

// Control condition
  var controlcond = {
    timeline_variables: stims,
    randomize_order: true,
    choices: jsPsych.NO_KEYS,
    trial_duration: delayTrial,
    post_trial_gap: delayIti,
    repetitions: 2, // total: 32 trials
    on_load: function () {
      $('.jspsych-content').css({ "max-width": "100%" });
    },
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function () {
          var Img = jsPsych.timelineVariable('CS', true);
        html = '';
        html += "<img class='paringsImgsRight' src='" + Img + "'>";
        return html;
      },
      on_finish: function (data) {
        $('.jspsych-content').css({ "max-width": "90%" });
        data.task = "evacond"; //controlcond
        data.CS = jsPsych.timelineVariable('CS', true);
      },
    }]
  };

  /* RC INSTRUCTIONS */
  var RCinst1 = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
        var html = "";
        html += "<h1>TASK 2: Recognition task</h1>";
        html += "<p class = 'justify'>You will now perform the recognition task. You should know that <b>each group of faces</b> that you previously saw ";
        html += "(those with a " + color1 + " background and those with a " + color2 + " background) ";
        html += "was in fact <b>very different from the other group.</b></br></br>";
        html += "Moreover, <b>within each group</b>, the faces also shared a series of physical characteristics, ";
        html += "making them <b>similar to each other</b>.</p>";
        html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
        return html;
      },
  };

    var RCinst2 = {
    type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 2: Recognition task</h1>";
            html += "<p class = 'justify'> In this task, we will present a series of faces similar to the one below. ";
            html += "At each trial, <b>we will present you 12 faces.</b> ";
            html += "These faces will again be blurred but with a different kind of blur this time. ";
            html += "As a result of this, the 12 faces you will see will look rather similar to each other. However, <b>the faces are all (slightly) different.</b></p>";
            html += "<img width='200' style='padding: 0px' src='" + imgLink(474, 'ori') + "'>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

    var RCinst3a = {
    type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 2: Recognition task (Part 1)</h1>";
            html += "<p class = 'justify'>At each trial, your task is to choose among the 12 faces ";
            html += "the one that you think is <b>the most similar to the group of faces that had a " + color1 + " background.</b></p>";
            html += "<p class = 'justify'>Use your mouse to select a face at each trial.</p>";
            html += "<img width='200' style='padding: 0px' src='" + imgLink(474, 'ori') + "'>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

    var RCinst3b = {
    type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 2: Recognition task (Part 2)</h1>";
            html += "<p class = 'justify'>At each trial, your task is to choose among the 12 faces ";
            html += "the one that you think is <b>the most similar to the group of faces that had a " + color2 + " background.</b></p>";
            html += "<p class = 'justify'>Use your mouse to select a face at each trial.</p>";
            html += "<img width='200' style='padding: 0px' src='" + imgLink(474, 'ori') + "'>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

    var RCinst4 = {
    type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 2: Recognition task</h1>";
            html += "<p class = 'justify'>Before you start, please note that: </br></br>";
            html += "<b>There are no good or bad answers!</b> ";
            html += "You just have to make a choice as <b>intuitively</b> as possible. ";
            html += "On average, for each trial, participants take about <b>3 seconds</b> ";
            html += "to select a face. Please <b>try to maintain a similar pace</b>.</br></br>";
            html += "In this part of the task, you will have to peform a total of 150 trials.</p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

    var RCinst5 = {
    type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<p class = 'justify'>The first part of this task is completed.</br>";
            html += "You will now begin to the second part.</p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };


// RC ---------------------------------------------------------------------------------------------------------------
/* Generate RC trials */

    var imgsRC = $.map($(Array(numOfPairs)), function (val, i) { return i + 1; }); // generate numerical sequence

    imgsRC.map(function (e) {
        preloadimages.push(imgLink(e, 'ori'));
        preloadimages.push(imgLink(e, 'inv'));
    });

    var genFacesPerSlide = function (numOfFacesPerTrial, imgs) {
        numOfFacesPerTrial = numOfFacesPerTrial / 2;
        var chunkedArray = [];
        var i, j, trialImgs, chunk = numOfFacesPerTrial;

        for (i = 0, j = imgs.length; i < j; i += chunk) {

            trialImgs = imgs.slice(i, i + chunk);

            var tempOri = [];
            var tempInv = [];

            trialImgs.map(function (e) {
                tempOri.push(imgLink(e, 'ori'));
                tempInv.push(imgLink(e, 'inv'));
            });

            trialImgs = _.flattenDeep([tempOri, tempInv]);

            // trialImgs = _.shuffle(trialImgs); // randomize order in slide

            chunkedArray.push({
                trialImgs
            });
        }
        return chunkedArray;
    };

    var RCstim = genFacesPerSlide(12, imgsRC); // RC fast-12: 250 trials (6 ori + 6 anti = 12  faces per trial)

/* RC */
    var i = 1;
    var RC1 = {
        timeline_variables: RCstim,
        randomize_order: true,
        //sample: {
        //    type: 'custom',
        //    fn: function (t) { return [1, 2, 3] }
        //},
        data: {
            task: 'RC1',
            background: color1name,
            RCcolor: 'first',
            colorOrder: colorOrder
        },
        timeline: [{
            type: 'html-mouse-response',
            stimulus: function () {
                html = "";
                html += "<p>Select the face that you think is the most similar to </br>the group of faces ";
                html += "that had a " + color1 + " background</br></br>";
                jsPsych.timelineVariable('trialImgs', true).map(function (e) {
                    html += "<img class='rcimg-12' src='" + e + "'>";
                });
                html += "</br> Trial: " + i + "/150</br>";
                i += 1;
                return html;
            },
        }]
    };

    var ii = 1;
    var RC2 = {
        timeline_variables: RCstim,
        randomize_order: true,
        //sample: {
        //    type: 'custom',
        //    fn: function (t) { return [1, 2, 3] }
        //},
        data: {
            task: 'RC2',
            background: color2name,
            RCcolor: 'second',
            colorOrder: colorOrder
        },
        timeline: [{
            type: 'html-mouse-response',
            stimulus: function () {
                html = "";
                html += "<p>Select the face that you think is the most similar to </br>the group of faces ";
                html += "that had a " + color2 + " background</br></br>";
                jsPsych.timelineVariable('trialImgs', true).map(function (e) {
                    html += "<img class='rcimg-12' src='" + e + "'>";
                });
                html += "</br> Trial: " + ii + "/150</br>";
                ii += 1;
                return html;
            },
        }]
    };

// Questions ---------------------------------------------------------------------------------------------------------------

/* Questions INSTRUCTIONS */
  var Instr_Quest = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    on_load: function() {
          $('.jspsych-content-wrapper').css({ "width": "900px" });
          $(".jspsych-content").css("max-width", "90%");
          $('.jspsych-content-wrapper').css({ "height": "1200px" });
    },
    stimulus: function() {
      var html = "";
      html += "<p class='justify'>TASK 2 is over. Now, we will ask you a few questions about the previous tasks and about yourself. ";
      html += "It is extremely important that you try to answer <b>as honestly and as spontaneously as possible.</b></br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };

// Liking
    var likertPreamble = '<p class = "justify">Please indicate your degree of (dis)agreement with the statements listed below. ' +
        'To do so, use the following scale: ' +
        'from 1 = “Totally disagree” to 7 = “Totally agree”</p>';

    var likertScale = ["1</br>Totally disagree", "2", "3", "4", "5", "6", "7</br>Totally agree"];


    var likingGrpItems = [
        'I like the ' + genColor("#b5a21b", "yellow") + ' group.',
        'I like the ' + genColor("#2a57ea", "blue") + ' group.',
        'Please answer 4 to this statement.',
        'The ' + genColor("#b5a21b", "yellow") + ' group is positive.',
        'The ' + genColor("#2a57ea", "blue") + ' group is positive.',
    ];

    var questionsLikingGrp = [];
    likingGrpItems.map(function (item) { questionsLikingGrp.push({ prompt: '<i>' + item + '</i>', labels: likertScale, required: true }); });

    var likingGrp = {
        type: 'survey-likert',
        preamble: likertPreamble,
        questions: questionsLikingGrp,
        post_trial_gap: 300,
        on_finish: function (data) {
            $(".jspsych-content-wrapper").css("height", "1200px");
            var parsed_response = JSON.parse(data.responses);
            jsPsych.data.addProperties({
                likingYellow1: parsed_response.Q0,
                likingBlue1: parsed_response.Q1,
                AttentionCheck: parsed_response.Q2,
                likingYellow2: parsed_response.Q3,
                likingBlue2: parsed_response.Q4,
            });
        },
    };

// memory of valence - color of group for the placebo condition 
var PosNegGrpOptions_plac = ['the ' + genColor("#2a57ea", "blue") + ' group was paired with pleasant pictures and the ' + genColor("#b5a21b", "yellow") + ' group with unpleasant pictures ', 'the ' + genColor("#b5a21b", "yellow") + ' group was paired with pleasant pictures and the ' + genColor("#2a57ea", "blue") + ' group with unpleasant pictures ', 'I do not remember'];

var reportedPairing_plac = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "Please report the instruction that we provided about how the two groups were paired with pleasant and unpleasant pictures: (if you do not remember, select the 'I do not remember' option)", options: PosNegGrpOptions_plac, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                reportedPairing: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

// memory of valence - color of group for the instruction condition 
var PosNegGrpOptions_instr = ['the ' + genColor("#2a57ea", "blue") + ' group will be paired with pleasant pictures and the ' + genColor("#b5a21b", "yellow") + ' group with unpleasant pictures ', 'the ' + genColor("#b5a21b", "yellow") + ' group will be paired with pleasant pictures and the ' + genColor("#2a57ea", "blue") + ' group with unpleasant pictures ', 'I do not remember'];

var reportedPairing_instr = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "Please report the instruction that we provided about how the two groups will be paired with pleasant and unpleasant pictures in the upcoming task: (if you do not remember, select the 'I do not remember' option)", options: PosNegGrpOptions_instr, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                reportedPairing: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

  var demand_awareness = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'What do you think the researchers were trying to achieve in this study?', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                demand_awareness: JSON.parse(data.responses).Q0,
            });
        },
    };

  var influence_awareness = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Do you think that, in TASK 1, the pleasantness of the pictures presented on the "+USposition+" (i.e., together with faces of the blue and yellow groups) influenced your responses in TASK 2 when you had to select the face that looked the most like the blue and yellow groups?", options: ['Yes', 'No', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              influence_awareness: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var demand_compliance = {
      type: 'survey-multi-choice',
      questions: [{prompt: "When we asked you to complete TASK 2, did you respond truthfully? Or did you try to fake your response (i.e., tried to tell us what you thought we wanted to hear)? Please be honest here (it will not affect payment in any way).", options: ['Yes - I faked my response based on what I thought the researchers wanted to find', 'No - my responses were based on how I genuinely felt', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              demand_compliance: JSON.parse(data.responses)["Q0"],
          });
      },
  };

 /* AGE */
  var age = {
      timeline: [{
        type: 'survey-text',
        questions: [{prompt: "How old are you?", rows: 1, columns: 10}],
        button_label: "Continue",
      }],
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      loop_function: function(data){ 
        var age = data.values()[0].responses;
        var age = JSON.parse(age).Q0; 
        if(age == ""){
          alert("Please indicate your age"); 
          return true; 
        }
      },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              age: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var gender = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Please indicate your gender:", options: ['Male', 'Female', 'Other'], required: true}],
      button_label: "Continue",
      on_finish: function(data) {
          jsPsych.data.addProperties({
              gender: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var languageOptions = ['Native speaker', 'Very well', 'Well', 'Average', 'Badly', 'Very badly'];
  var language = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "How well do you speak english?", options: languageOptions, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                language: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

  var Prolific_reported = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Please indicate your Prolific ID:', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Prolific_reported: JSON.parse(data.responses).Q0,
            });
        },
    };

  var comments = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Do you have comments regarding this study? [Optional]', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Comment: JSON.parse(data.responses).Q0,
            });
        },
    };

 /* EXIT FULLSCREEN MODE */
  var exitFullscreen = {
    type: 'fullscreen',
    fullscreen_mode: false
  };

    /* DEBRIEF */
  var debrief = [];
  debrief += "<h1>End of the study</h1>";
  debrief += "<p class='justify'>Thank you for participating in this online experiment!<br><br>";
  debrief += "In some experiments, we cannot tell people everything about the experiment at the beginning because their responses would not be ";
  debrief += "natural. For example, if we told people what the point of the experiment was ahead of time, then some people might do whatever ";
  debrief += "it is they think we want them to do, just to be helpful. Other people might do the exact opposite of what they think we want "; 
  debrief += "them to do, just to show us that we cannot figure them out. When people are trying to second-guess what the experiment is "; 
  debrief += "really about, and they behave a certain way because of it, our results get messed up. That is because they are not behaving "; 
  debrief += "like they naturally would in the real world. The whole point of this experiment is to find out how people would ";
  debrief += "naturally behave.<br><br>";
  debrief += "Now we would like to explain what we were trying to learn about with this study. In the first task (TASK 1), we told you that we systematically "; 
  debrief += "presented pleasant vs. unpleasant pictures together with pictures of blue and yellow group members or that you would experience this in the future. This was meant to influence your evaluation of the blue and yellow group. "; 
  debrief += "For instance, you should like the blue group more than the yellow group if you were led to believe that the blue group was presented together with pleasant pictures and the yellow group with unpleasant pictures. But this should not happen if you were led to think these pairings would occur in the future. Importantly, you should know that faces of the blue and yellow group were always equally often presented with pleasant and unpleasant pictures. In this study, we wanted to target your belief (that this was the case) and not the actual pairing. <br><br>";
  debrief += "But our more specific goal here was to test whether TASK 1 could change how you visually represent the typical face of blue and yellow group members. "; 
  debrief += "More specifically, if you thought that the blue group was presented together with positive pictures, you should have a more positive visual representation "; 
  debrief += "of the blue group (as compared to the yellow group; e.g., a smiling and trustworthy face). We measured your visual representations of the blue and yellow group in TASK 2. <br><br>";
  debrief += "We would like to emphasize that there are no correct responses in this study: We were looking at people’s natural responses. ";
  debrief += "We hope you understand that we couldn't tell you all of this before because it would have ruined our study. ";
  debrief += "Again, your responses will be anonymous and will be analyzed as part of a group of responses.</br></br>";
  debrief += "We hope this explanation was clear. If you want additional information, if you have any questions, or if you would like ";
  debrief += "to withdraw consent and have your data excluded, do not hesitate to contact us via Prolific Academic. If you are "; 
  debrief += "interested, you can also ask for the results of this experiment—be aware, however, that this could take several weeks "; 
  debrief += "to gather all the data we need and to analyze them. <br><br>";
  debrief += "You can copy this code on Prolific: <b>C16B3THV</b> ";
  debrief += "or you can click on the following link to validate your participation:</p>";
  debrief += "<a href='https://app.prolific.com/submissions/complete?cc=C16B3THV' target='_blank'>click here</a><br><br>";


  /* TIMELINES ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  //timeline.push(consent);
  timeline.push(activeFullscreen
                );

  switch(pairing_cond) {
  case "placebo_blue_pos_G1B":
    timeline.push(Instr_gene1,
                    Instr_EC_1_PlacEC,
                    evacond,
                    Instr_EC_2_G1B,
                    Instr_EC_3_posBlue_placebo,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    demand_awareness,
                    influence_awareness,
                    demand_compliance
                    );
      break;
  case "placebo_yellow_pos_G1B":
    timeline.push(Instr_gene1,
                    Instr_EC_1_PlacEC,
                    evacond,
                    Instr_EC_2_G1B,
                    Instr_EC_3_posYellow_placebo,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    demand_awareness,
                    influence_awareness,
                    demand_compliance
                    );
    break;
  case "placebo_blue_pos_G1Y":
    timeline.push(Instr_gene1,
                    Instr_EC_1_PlacEC,
                    evacond,
                    Instr_EC_2_G1Y,
                    Instr_EC_3_posBlue_placebo,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    demand_awareness,
                    influence_awareness,
                    demand_compliance
                    );
      break;
  case "placebo_yellow_pos_G1Y":
    timeline.push(Instr_gene1,
                    Instr_EC_1_PlacEC,
                    evacond,
                    Instr_EC_2_G1Y,
                    Instr_EC_3_posYellow_placebo,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    demand_awareness,
                    influence_awareness,
                    demand_compliance
                    );
      break;
  case "instruction_blue_pos_G1B":
    timeline.push(Instr_gene1,
                    Instr_EC_1_Instr,
                    controlcond,
                    Instr_EC_2_G1B,
      Instr_EC_instruction_intermediary,
                    Instr_EC_3_posBlue_instruction,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    demand_awareness,
                    demand_compliance
                    );
      break;
  case "instruction_yellow_pos_G1B":
    timeline.push(Instr_gene1,
                    Instr_EC_1_Instr,
                    controlcond,
                    Instr_EC_2_G1B,
      Instr_EC_instruction_intermediary,
                    Instr_EC_3_posYellow_instruction,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    demand_awareness,
                    demand_compliance
                    );
    break;
  case "instruction_blue_pos_G1Y":
    timeline.push(Instr_gene1,
                    Instr_EC_1_Instr,
                    controlcond,
                    Instr_EC_2_G1Y,
      Instr_EC_instruction_intermediary,
                    Instr_EC_3_posBlue_instruction,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    demand_awareness,
                    demand_compliance
                    );
      break;
  case "instruction_yellow_pos_G1Y":
    timeline.push(Instr_gene1,
                    Instr_EC_1_Instr,
                    controlcond,
                    Instr_EC_2_G1Y,
      Instr_EC_instruction_intermediary,
                    Instr_EC_3_posYellow_instruction,
                    RCinst1,
                    RCinst2,
                    RCinst3a,
                    RCinst4,
                    RC1,
                    RCinst5,
                    RCinst3b,
                    RCinst4,
                    RC2,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    demand_awareness,
                    demand_compliance
                    );
      break;
  }
      timeline.push(age,
                    gender,
                    language,
                    Prolific_reported,
                    comments,
                    exitFullscreen
                    );


  preloadimages = _.flattenDeep(preloadimages);

  timeline = _.flattenDeep(timeline); // do not remove this!

  /* INITIALISE EXP  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  jsPsych.init({
    timeline: timeline,
    preload_images: preloadimages,
    max_load_time: 500*1000,
    exclusions: {
      min_width: 1100,
      min_height: 600,
      max_width: 1600,
      max_height: 900,
    },
    on_finish: function (data) {
      $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");


      /* Initialize Firebase */
      var config = {
        apiKey: "AIzaSyAPTEPrT8V9T1-GouWXnW6jknK3brmagJs",
        databaseURL: "https://postdocgent.firebaseio.com/"
      };

      firebase.initializeApp(config);
      var database = firebase.database();

      /* jsPsych: add data to every trial */
      jsPsych.data.addProperties({
        jspsych_id: jspsych_id,
        prolificID: prolificID,
        pairing_cond: pairing_cond,
        CSposition: CSposition,
        colorOrder: colorOrder,
        totalTime: jsPsych.totalTime()
      });

        var dataRC = jsPsych.data.get().filterCustom(function (x) {
          return x.task == "RC1" || x.task == "RC2"
        }).csv();

      var dataEC = data.filter({ task: 'evacond' }).csv();

      /* Send data to Firebase */
      database
        .ref("EC_placebo_3/" + jspsych_id + "/")
        .update({ dataEC })
        .then(function () {
      database
        .ref("EC_placebo_3/" + jspsych_id + "/")
        .update({ dataRC })
        .then(function () {
              console.log("Data sent!");
              $("#jspsych-content").html(debrief);
        });
      });
    }
  });
</script>

</html>